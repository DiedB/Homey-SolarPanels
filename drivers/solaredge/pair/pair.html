<style type="text/css">
	.input-field {
		margin-top: 10px;
	}

	.submit-button {
		margin-top: 10px;
	}
</style>

<div class="form-group">
	<div class="input-field">
		<label>Please enter your SolarEdge system ID and API key:</label>
		<input type="text" id="sid" placeholder="System ID" value="" />
		<input type="text" id="key" placeholder="API key" value="" />
	</div>

	<div class="input-field">
		<label>Inverter Serial Number (optional)</label>
		<input type="text" id="serial_number" placeholder="Serial number" value="" />
		<p>The last 10 digits of the device serial number, in the format: XXXXXXXX-XX.</p>
		<p>For example: if the product serial number is SF0112A-07F123456-1B, insert: 7F123456-1B. The serial number is printed on the device label.</p>
	</div>

	<div class="input-field">
		<label>Give your inverter a name:</label>
		<input type="text" id="name" placeholder="Name" value="" />
	</div>

	<button class="submit-button" id="validate">Connect</button>
</div>

<script type="text/javascript">
	$(() => {
		$('#validate').click(() => {
			Homey.showLoadingOverlay();

			var sid = $('#sid').val();
			var key = $('#key').val();
			var serial_number = $("#serial_number").val()
			var name = $('#name').val();

			if (serial_number.length) {
				serial_number = serial_number.toUpperCase();
				if (serial_number.length !== 11) {
					serial_number = null;
				}
			}

			var deviceDefinition = {
				name,
				data: { sid, serial_number },
				settings: { key	}
			};

			Homey.emit('validate', deviceDefinition, (error, result) => {
				if (error) {
					Homey.hideLoadingOverlay();
					Homey.alert(error);
				} else {
					Homey.createDevice(deviceDefinition, (error, result) => {
						if (error) {
							Homey.hideLoadingOverlay();
							Homey.alert(error);
						} else {
							Homey.done();
						}
					});
				}
			});
		});
	});
</script>